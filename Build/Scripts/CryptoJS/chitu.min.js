var chitu;!function(a){function b(a,b){var c="http://".toLowerCase();if(a.substr(0,c.length).toLowerCase()==c){var d=document.createElement("a");d.setAttribute("href",a),a=decodeURI(d.pathname);var e=f.addRoute(a);return c+d.host+e.interpolate(b)}var e=f.addRoute(a);return e.interpolate(b)}function c(c){var d=c.values().action;if(!d)throw e.routeDataRequireAction();var f=b(c.actionPath(),c.values()),h=$.Deferred();return requirejs([f],function(b){b||(console.warn(a.Utility.format("加载活动“{1}.{0}”失败。",d,c.values().controller)),h.reject());var e=b.func||b;if(!$.isFunction(e))throw a.Errors.modelFileExpecteFunction(d);var f=new g(self,d,e);h.resolve(f)},function(a){return h.reject(a)}),h}function d(a){if(!a.values().controller)throw e.routeDataRequireController();if(!a.values().action)throw e.routeDataRequireAction();var c=b(a.viewPath(),a.values()),d=$.Deferred(),f="http://";return c.substr(0,f.length).toLowerCase()==f?$.ajax({url:c}).done(function(a){null!=a?d.resolve(a):d.reject()}).fail(function(a){return d.reject(a)}):requirejs(["text!"+c],function(a){null!=a?d.resolve(a):d.reject()},function(a){return d.reject(a)}),d}var e=a.Errors,f=window.crossroads,g=function(){function b(b,c,d){if(!b)throw a.Errors.argumentNull("controller");if(!c)throw a.Errors.argumentNull("name");if(!d)throw a.Errors.argumentNull("handle");if(!$.isFunction(d))throw a.Errors.paramTypeError("handle","Function");this._name=c,this._handle=d}return b.prototype.name=function(){return this._name},b.prototype.execute=function(b){if(!b)throw e.argumentNull("page");var c=this._handle.apply({},[b]);return a.Utility.isDeferred(c)?c:$.Deferred().resolve()},b}();a.Action=g,a.createActionDeferred=c,a.createViewDeferred=d}(chitu||(chitu={}));var chitu;!function(a){var b=a,c=(a.Utility,a.Errors),d=10,e=function(){function e(d){if(this.pageCreating=b.Callbacks(),this.pageCreated=b.Callbacks(),this.page_stack=[],this._routes=new a.RouteCollection,this._runned=!1,null==d)throw c.argumentNull("container");if(!d.container)throw new Error("The config has not a container property.");if(!$.isFunction(d.container)&&!d.container.tagName)throw new Error("Parameter container is not a function or html element.");this._config=d,this._config.openSwipe=d.openSwipe||function(b){return a.SwipeDirection.None},this._config.closeSwipe=d.closeSwipe||function(b){return a.SwipeDirection.None},this._config.scrollType=d.scrollType||function(b){return a.ScrollType.Document}}return Object.defineProperty(e.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),e.prototype.on_pageCreating=function(b){return a.fireCallback(this.pageCreating,[this,b])},e.prototype.on_pageCreated=function(b,c){return a.fireCallback(this.pageCreated,[this,b])},e.prototype.routes=function(){return this._routes},e.prototype.currentPage=function(){return this.page_stack.length>0?this.page_stack[this.page_stack.length-1]:null},e.prototype.previousPage=function(){return this.page_stack.length>1?this.page_stack[this.page_stack.length-2]:null},e.prototype.hashchange=function(){if(1==window.location.skip)return void(window.location.skip=!1);var a;this.back_deferred&&null==this.back_deferred.processed&&(a=this.back_deferred,a.processed=!0);var b=window.location.hash;if(!b||b==this.start_flag_hash)return b||console.log("The url is not contains hash.url is "+window.location.href),b==this.start_flag_hash&&(window.history.pushState({},"",this.start_hash),console.log("The hash is start url, the hash is "+b)),void(a&&a.reject());this.start_flag_hash||(this.start_flag_hash="#AABBCCDDEEFF",this.start_hash=b,window.history.replaceState({},"",this.start_flag_hash),window.history.pushState({},"",b));var c="";if(null!=this.previousPage()&&(c=this.previousPage().routeData.url()),c.toLowerCase()==b.substr(1).toLowerCase())this.closeCurrentPage();else{var d=window.location.arguments||{};window.location.arguments=null,this.showPage(b.substr(1),d)}a&&a.resolve()},e.prototype.run=function(){if(!this._runned){$.proxy(this.hashchange,this)(),$(window).bind("hashchange",$.proxy(this.hashchange,this)),this._runned=!0}},e.prototype.getCachePage=function(a){for(var b=this.page_stack.length-1;b>=0;b--)if(this.page_stack[b].name==a)return this.page_stack[b];return null},e.prototype.showPage=function(a,b){if(b=b||{},!a)throw c.argumentNull("url");var e=this.routes().getRouteData(a);if(null==e)throw c.noneRouteMatched(a);var f;if($.isFunction(this.config.container)){if(f=this.config.container(e.values()),null==f)throw new Error("The result of continer function cannt be null")}else f=this.config.container;var g=this.currentPage(),h=document.createElement("div");f.appendChild(h);var i=this.createPage(a,h,g);if(this.page_stack.push(i),console.log("page_stack lenght:"+this.page_stack.length),this.page_stack.length>d){var j=this.page_stack.shift();j.close({})}var k=this.config.openSwipe(e);return $.extend(b,e.values()),i.open(b,k).done(function(){g&&g.hide()}),i},e.prototype.createPageNode=function(){var a=document.createElement("div");return a},e.prototype.closeCurrentPage=function(){var a=this.currentPage(),b=this.previousPage();if(null!=a){var c=this.config.closeSwipe(a.routeData);a.close({},c),null!=b&&b.show(),this.page_stack.pop(),console.log("page_stack lenght:"+this.page_stack.length)}},e.prototype.createPage=function(d,e,f){if(!d)throw c.argumentNull("url");if(!e)throw c.argumentNull("element");var g=this.routes().getRouteData(d);if(null==g)throw c.noneRouteMatched(d);var h=(g.values().controller,g.values().action,a.createViewDeferred(g)),i=a.createActionDeferred(g),j=new b.PageContext(h,g);this.on_pageCreating(j);var k=this.config.scrollType(g),l=new b.Page(e,k,f);return l.routeData=g,l.view=h,l.action=i,this.on_pageCreated(l,j),l},e.prototype.redirect=function(a,b){return void 0===b&&(b={}),window.location.skip=!0,window.location.hash=a,this.showPage(a,b)},e.prototype.back=function(a){return void 0===a&&(a=void 0),this.back_deferred=$.Deferred(),0==window.history.length?(this.back_deferred.reject(),this.back_deferred):(window.history.back(),this.back_deferred)},e}();a.Application=e}(chitu||(chitu={}));var chitu;!function(a){var b=a.Utility,c=function(){function a(){}return a.argumentNull=function(a){var c=b.format('The argument "{0}" cannt be null.',a);return new Error(c)},a.modelFileExpecteFunction=function(a){var c=b.format('The eval result of script file "{0}" is expected a function.',a);return new Error(c)},a.paramTypeError=function(a,c){var d=b.format('The param "{0}" is expected "{1}" type.',a,c);return new Error(d)},a.viewNodeNotExists=function(a){var c=b.format('The view node "{0}" is not exists.',a);return new Error(c)},a.pathPairRequireView=function(a){var c=b.format('The view value is required for path pair, but the item with index "{0}" is miss it.',a);return new Error(c)},a.notImplemented=function(a){var c=b.format('The method "{0}" is not implemented.',a);return new Error(c)},a.routeExists=function(a){var c=b.format('Route named "{0}" is exists.',a);return new Error(c)},a.routeResultRequireController=function(a){var c=b.format('The parse result of route "{0}" does not contains controler.',a);return new Error(c)},a.routeResultRequireAction=function(a){var c=b.format('The parse result of route "{0}" does not contains action.',a);return new Error(c)},a.ambiguityRouteMatched=function(a,c,d){var e=b.format("Ambiguity route matched, {0} is match in {1} and {2}.",a,c,d);return new Error(e)},a.noneRouteMatched=function(a){var c=b.format('None route matched with url "{0}".',a),d=new Error(c);return d},a.emptyStack=function(){return new Error("The stack is empty.")},a.canntParseUrl=function(a){var c=b.format('Can not parse the url "{0}" to route data.',a);return new Error(c)},a.routeDataRequireController=function(){var a='The route data does not contains a "controller" file.';return new Error(a)},a.routeDataRequireAction=function(){var a='The route data does not contains a "action" file.';return new Error(a)},a.parameterRequireField=function(a,c){var d=b.format("Parameter {1} does not contains field {0}.",a,c);return new Error(d)},a.viewCanntNull=function(){var a="The view or viewDeferred of the page cannt null.";return new Error(a)},a}();a.Errors=c}(chitu||(chitu={}));var chitu;!function(a){function b(a){var b=f[a]={};return jQuery.each(a.match(e)||[],function(a,c){b[c]=!0}),b}function c(c){void 0===c&&(c=null),c="string"==typeof c?f[c]||b(c):jQuery.extend({},c);var d,e,g,h,i,j,k=[],l=!c.once&&[],m=function(a){for(d=c.memory&&a,e=!0,j=h||0,h=0,i=k.length,g=!0;k&&i>j;j++){var b=k[j].apply(a[0],a[1]);if(null!=b&&a[0].results.push(b),b===!1&&c.stopOnFalse){d=!1;break}}g=!1,k&&(l?l.length&&m(l.shift()):d?k=[]:n.disable())},n={results:[],add:function(){if(k){var a=k.length;!function b(a){jQuery.each(a,function(a,d){var e=jQuery.type(d);"function"===e?c.unique&&n.has(d)||k.push(d):d&&d.length&&"string"!==e&&b(d)})}(arguments),g?i=k.length:d&&(h=a,m(d))}return this},remove:function(){return k&&jQuery.each(arguments,function(a,b){for(var c;(c=jQuery.inArray(b,k,c))>-1;)k.splice(c,1),g&&(i>=c&&i--,j>=c&&j--)}),this},has:function(a){return a?jQuery.inArray(a,k)>-1:!(!k||!k.length)},empty:function(){return k=[],i=0,this},disable:function(){return k=l=d=void 0,this},disabled:function(){return!k},lock:function(){return l=void 0,d||n.disable(),this},locked:function(){return!l},fireWith:function(a,b){return a.results=[],!k||e&&!l||(b=b||[],b=[a,b.slice?b.slice():b],g?l.push(b):m(b)),a.results},fire:function(){return n.fireWith(this,arguments)},fired:function(){return!!e},count:function(){return k.length}};return new a.Callback(n)}function d(b,c){for(var d=b.fire.apply(b,c),e=[],f=0;f<d.length;f++)a.Utility.isDeferred(d[f])&&e.push(d[f]);return 0==e.length?$.Deferred().resolve():$.when.apply($,e)}var e=/\S+/g,f={},g=function(){function a(a){this.source=a}return a.prototype.add=function(a){this.source.add(a)},a.prototype.remove=function(a){this.source.remove(a)},a.prototype.has=function(a){return this.source.has(a)},a.prototype.fireWith=function(a,b){return this.source.fireWith(a,b)},a.prototype.fire=function(a,b,c,d){return this.source.fire(a,b,c)},a}();a.Callback=g,a.Callbacks=c,a.fireCallback=d;var h=window.crossroads;$.extend(h,{_create:h.create,create:function(){var b=this._create();return b.getRouteData=function(b,c){if(b=b||"",c=c||[],this.ignoreState||b!==this._prevMatchedRequest&&b!==this._prevBypassedRequest){var d=this._getMatchedRoutes(b),e=d.length;if(0==e)return null;if(e>1)throw a.Errors.ambiguityRouteMatched(b,"route1","route2");return d[0]}},b}})}(chitu||(chitu={}));var chitu;!function(a){var b;!function(a){function b(a,b){b=b||{},b=$.extend({text:function(a){this.element.innerHTML=e[a]}},b);var c=b.element;if(null==c){c=document.createElement("div"),c.className="page-pulldown",c.innerHTML=f.init;var d=a.nodes().content;0==d.childNodes.length?d.appendChild(c):d.insertBefore(c,d.childNodes[0]),b.element=c}var h=new g(b);return h}a.createPullDownBar=b;var c=function(){function a(){}return a.PULLDOWN_EXECUTE_CRITICAL_HEIGHT=60,a.PULLUP_EXECUTE_CRITICAL_HEIGHT=60,a.PULL_DOWN_MAX_HEIGHT=150,a.PULL_UP_MAX_HEIGHT=150,a.MINI_MOVE_DISTANCE=3,a}();a.config=c;var d=function(){function a(){}return a.init="init",a.ready="ready",a.doing="doing",a.done="done",a}();a.RefreshState=d;var e=function(){function a(){}return a.init='<div style="padding-top:10px;">下拉可以刷新</div>',a.ready='<div style="padding-top:10px;">松开后刷新</div>',a.doing='<div style=""><i class="icon-spinner icon-spin"></i><span>&nbsp;正在更新中</span></div>',a.done='<div style="padding-top:10px;">更新完毕</div>',a}();a.PullDownStateText=e;var f=function(){function a(){}return a.init="上拉可以刷新",a.ready="松开后刷新",a.doing='<div><i class="icon-spinner icon-spin"></i><span>&nbsp;正在更新中</span></div>',a.done="更新完毕",a}();a.PullUpStateText=f;var g=function(){function a(a){this._config=a,this.status(d.init)}return a.prototype.status=function(a){return void 0===a&&(a=void 0),void 0===a?this._status:(this._status=a,void this._config.text(a))},a.prototype.execute=function(){var a=this,b=$.Deferred();return window.setTimeout(function(){return b.resolve()},2e3),b.done(function(){return a.status(d.init)}),b},a.createPullDownBar=function(b,c){c=c||{},c=$.extend({text:function(a){this.element.innerHTML=e[a]}},c);var d=c.element;if(null==d){d=document.createElement("div"),d.className="page-pulldown",d.innerHTML=f.init;var g=b.nodes().content;0==g.childNodes.length?g.appendChild(d):g.insertBefore(d,g.childNodes[0]),c.element=d}var h=new a(c);return h},a}();a.PullDownBar=g;var h=function(){function a(a){this._config=a,this.status(d.init)}return a.prototype.status=function(a){return void 0===a&&(a=void 0),void 0===a?this._status:(this._status=a,void this._config.text(a))},a.prototype.execute=function(){var a=this,b=this._config.execute();return null!=b&&$.isFunction(b.done)&&b.done(function(){return a.status(d.init)}),b},a.createPullUpBar=function(b,c){c=c||{},c=$.extend({execute:function(){},text:function(a){this.element.innerHTML=f[a]}},c);var d=b.nodes().pullup;if(null==d){d=document.createElement("div"),d.className="page-pullup",d.style.textAlign="center";var e=b.nodes().content;e.appendChild(d)}return c.element=d,new a(c)},a}();a.PullUpBar=h}(b=a.gesture||(a.gesture={}))}(chitu||(chitu={}));var chitu;!function(a){var b;!function(a){function b(b,c,d,e){var f,g,h,i=0,j=(c.cur_scroll_args,b(c.nodes().content)),k=!1,l=!1,m=new Hammer(c.nodes().content);m.get("pan").set({direction:Hammer.DIRECTION_UP|Hammer.DIRECTION_DOWN}),m.on("panstart",function(a){var j=c.nodes().content.getBoundingClientRect(),n=c.nodes().body.getBoundingClientRect();null==g&&(g=j.top),null==h&&(h=j.height-$(c.nodes().body).height()),i=a.deltaY,k=null!=e&&Math.abs(n.bottom-j.bottom)<=20&&a.direction==Hammer.DIRECTION_UP,k&&(f=b(c.nodes().body)),l=null!=d&&Math.abs(j.top-g)<=20&&a.direction==Hammer.DIRECTION_DOWN,l===!0&&m.get("pan").set({direction:Hammer.DIRECTION_UP|Hammer.DIRECTION_DOWN,domEvents:!1})}),m.on("pan",function(b){var c=b;c.distance>a.config.PULL_DOWN_MAX_HEIGHT||(l===!0?(j.set("top",c.deltaY+"px").duration(0).end(),Math.abs(c.deltaY)>a.config.PULLDOWN_EXECUTE_CRITICAL_HEIGHT?d.status(a.RefreshState.ready):d.status(a.RefreshState.init),c.preventDefault()):k&&(f.y(c.deltaY-i).duration(0).end(),Math.abs(c.deltaY)>a.config.PULLUP_EXECUTE_CRITICAL_HEIGHT?e.status(a.RefreshState.ready):e.status(a.RefreshState.init)),i=b.deltaY)}),m.on("panend",function(f){var g=$.Deferred();if(l===!0)d.status()==a.RefreshState.ready?(j.set("top",a.config.PULLDOWN_EXECUTE_CRITICAL_HEIGHT+"px").duration(200).end(),d.status(a.RefreshState.doing),d.execute().done(function(){d.status(a.RefreshState.done),j.set("top","0px").duration(500).end(function(){console.log("scrollTop"),g.resolve()})})):j.set("top","0px").duration(200).end(function(){return g.resolve()});else if(k){e.status()==a.RefreshState.ready&&e.execute();var h=b(c.nodes().body);h.y(0).duration(200).end()}})}function c(a,c,d){requirejs(["move","hammer"],function(e,f){window.Hammer=f,b(e,a,c,d)})}a.enable_divfixed_gesture=c}(b=a.gesture||(a.gesture={}))}(chitu||(chitu={}));var chitu;!function(a){var b;!function(a){function b(b,c,d,e){console.log("enable_ios_gesture");var f,g,h=0,i=(c.cur_scroll_args,b(c.nodes().content)),j=!1,k=!1,l=new Hammer(c.nodes().content);l.get("pan").set({direction:Hammer.DIRECTION_UP|Hammer.DIRECTION_DOWN}),l.on("panstart",function(a){h=a.deltaY,j=null!=e&&Math.abs(c.iscroller.startY-c.iscroller.maxScrollY)<=20&&a.direction==Hammer.DIRECTION_UP,j&&(f=b(c.nodes().body)),k=null!=d&&Math.abs(c.iscroller.startY)<=20&&a.direction==Hammer.DIRECTION_DOWN,(k===!0||j===!0)&&(c.iscroller.enabled&&(c.iscroller.disable(),console.log("iscrol disable"),g=!0),l.get("pan").set({direction:Hammer.DIRECTION_UP|Hammer.DIRECTION_DOWN,domEvents:!1}))}),l.on("pan",function(b){var c=b;c.distance>a.config.PULL_DOWN_MAX_HEIGHT||(k===!0?(i.set("top",c.deltaY+"px").duration(0).end(),c.deltaY>a.config.PULLDOWN_EXECUTE_CRITICAL_HEIGHT?d.status(a.RefreshState.ready):d.status(a.RefreshState.init)):j&&(f.y(c.deltaY-h).duration(0).end(),Math.abs(c.deltaY)>a.config.PULLUP_EXECUTE_CRITICAL_HEIGHT?e.status(a.RefreshState.ready):e.status(a.RefreshState.init)),c.preventDefault(),h=b.deltaY)}),l.on("panend",function(f){var h=$.Deferred();if(k===!0)d.status()==a.RefreshState.ready?(i.set("top",a.config.PULLDOWN_EXECUTE_CRITICAL_HEIGHT+"px").duration(200).end(),d.status(a.RefreshState.doing),d.execute().done(function(){d.status(a.RefreshState.done),i.set("top","0px").duration(500).end(function(){console.log("scrollTop"),h.resolve()})})):i.set("top","0px").duration(200).end(function(){return h.resolve()});else if(j){e.status()==a.RefreshState.ready&&e.execute();var l=b(c.nodes().body);l.y(0).duration(200).end()}var m=c.nodes().content.getBoundingClientRect();j=null!=e&&Math.abs(c.iscroller.startY-c.iscroller.maxScrollY)<=20&&f.direction==Hammer.DIRECTION_UP,console.log(e),console.log(c.iscroller),console.log("enablePullUp:"+j),k=null!=d&&m.top<=0&&f.direction==Hammer.DIRECTION_DOWN,window.setTimeout(function(){g&&c.iscroller.enable()},100)})}function c(a,c,d){requirejs(["move","hammer"],function(e,f){window.Hammer=f,b(e,a,c,d)})}a.enable_iscroll_gesture=c}(b=a.gesture||(a.gesture={}))}(chitu||(chitu={}));var chitu;!function(a){function b(b,c,d){return void 0===d&&(d={}),a.fireCallback(b,[c,d])}var c=a,d=(a.Utility,a.Errors),e="page-node",f="page-header",g="page-body",h="page-footer",i="page-loading",j="page-content";!function(a){a[a.open=0]="open",a[a.scroll=1]="scroll",a[a.pullDown=2]="pullDown",a[a.pullUp=3]="pullUp",a[a.custom=4]="custom"}(a.PageLoadType||(a.PageLoadType={}));var k=a.PageLoadType,l=function(){function b(b,c,d){if(null==b)throw a.Errors.argumentNull("page");this._page=b,this.loadType=c,this.loading=d}return Object.defineProperty(b.prototype,"enableScrollLoad",{get:function(){return this._page.enableScrollLoad},set:function(a){this._page.enableScrollLoad=a},enumerable:!0,configurable:!0}),b}();a.PageLoadArguments=l;var m;!function(a){a[a.swipeLeft=0]="swipeLeft",a[a.swipeRight=1]="swipeRight",a[a.none=2]="none"}(m||(m={}));var n;!function(a){a[a.header=1]="header",a[a.body=2]="body",a[a.loading=4]="loading",a[a.footer=8]="footer"}(n||(n={}));var o;!function(a){a[a.open=0]="open",a[a.closed=1]="closed"}(o||(o={})),function(a){a[a.None=0]="None",a[a.Left=1]="Left",a[a.Right=2]="Right",a[a.Up=3]="Up",a[a.Donw=4]="Donw"}(a.SwipeDirection||(a.SwipeDirection={}));var p=a.SwipeDirection;!function(a){a[a.IScroll=0]="IScroll",a[a.Div=1]="Div",a[a.Document=2]="Document"}(a.ScrollType||(a.ScrollType={}));var q=a.ScrollType,r=function(){function a(a){a.className=e,this.container=a,this.header=document.createElement("div"),this.header.className=f,a.appendChild(this.header),this.body=document.createElement("div"),this.body.className=g,a.appendChild(this.body),this.content=document.createElement("div"),this.content.className=j,$(this.content).hide(),this.body.appendChild(this.content),this.loading=document.createElement("div"),this.loading.className=i,this.loading.innerHTML='<div class="spin"><i class="icon-spinner icon-spin"></i><div>',$(this.loading).hide(),this.body.appendChild(this.loading),this.footer=document.createElement("div"),this.footer.className=h,a.appendChild(this.footer)}return a}(),s=function(){function b(b){if(this.LOADDING_HTML='<i class="icon-spinner icon-spin"></i><span style="padding-left:10px;">数据正在加载中...</span>',!b)throw a.Errors.argumentNull("page");this._page=b,this._scrollLoad_loading_bar=document.createElement("div"),this._scrollLoad_loading_bar.innerHTML='<div name="scrollLoad_loading" style="padding:10px 0px 10px 0px;"><h5 class="text-center"></h5></div>',this._scrollLoad_loading_bar.style.display="none",$(this._scrollLoad_loading_bar).find("h5").html(this.LOADDING_HTML),b.nodes().content.appendChild(this._scrollLoad_loading_bar)}return b.prototype.show=function(){"block"!=this._scrollLoad_loading_bar.style.display&&(this._scrollLoad_loading_bar.style.display="block",this._page.refreshUI())},b.prototype.hide=function(){"none"!=this._scrollLoad_loading_bar.style.display&&(this._scrollLoad_loading_bar.style.display="none",this._page.refreshUI())},b}(),t=function(){function e(b,f,g){if(this._loadViewModelResult=null,this._openResult=null,this._hideResult=null,this._showTime=e.animationTime,this._hideTime=e.animationTime,this._enableScrollLoad=!1,this.is_closed=!1,this.actionExecuted=$.Deferred(),this.isActionExecuted=!1,this.preLoad=c.Callbacks(),this.load=c.Callbacks(),this.loadCompleted=c.Callbacks(),this.closing=c.Callbacks(),this.closed=c.Callbacks(),this.scroll=c.Callbacks(),this.showing=c.Callbacks(),this.shown=c.Callbacks(),this.hiding=c.Callbacks(),this.hidden=c.Callbacks(),this.scrollEnd=c.Callbacks(),this.viewChanged=$.Callbacks(),!b)throw d.argumentNull("element");if(null==f)throw d.argumentNull("scrollType");this._prevous=g,this._pageNode=new r(b),this.disableHeaderFooterTouchMove(),this._scrollType=f,f==q.IScroll?($(this.nodes().container).addClass("ios"),this.ios_scroller=new a.IOSScroll(this),a.gesture.enable_iscroll_gesture(this,null,null)):f==q.Div?($(this.nodes().container).addClass("div"),new a.DivScroll(this),a.gesture.enable_divfixed_gesture(this,null,null)):f==q.Document&&($(this.nodes().container).addClass("doc"),new a.DocumentScroll(this)),this.scrollEnd.add(e.page_scrollEnd)}return e.prototype.createPageLoadArguments=function(a,b,c){var d=new l(this,b,c);return d=$.extend(d,a||{})},Object.defineProperty(e.prototype,"formLoading",{get:function(){var a=this;return null==this._formLoading&&(this._formLoading={show:function(){$(a.nodes().loading).is(":visible")||($(a.nodes().loading).show(),$(a.nodes().content).hide())},hide:function(){$(a.nodes().loading).hide(),$(a.nodes().content).show()}}),this._formLoading},set:function(b){if(!b)throw a.Errors.argumentNull("value");this._formLoading=b},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottomLoading",{get:function(){return null==this._bottomLoading&&(this._bottomLoading=new s(this)),this._bottomLoading},set:function(b){if(!b)throw a.Errors.argumentNull("value");this._bottomLoading=b},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"view",{get:function(){return this._viewDeferred},set:function(a){this._viewDeferred=a},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"action",{get:function(){return this._actionDeferred},set:function(a){this._actionDeferred=a},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"enableScrollLoad",{get:function(){return this._enableScrollLoad},set:function(a){this._enableScrollLoad=a},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewHtml",{get:function(){return this.nodes().container.innerHTML},set:function(a){this.nodes().content.innerHTML=a;var b=this.nodes().content.querySelector('[ch-part="header"]');b&&this.nodes().header.appendChild(b),b=this.nodes().content.querySelector('[ch-part="footer"]'),b&&this.nodes().footer.appendChild(b),this.viewChanged.fire()},enumerable:!0,configurable:!0}),e.getPageName=function(a){var b;if(a.pageName()){var c=window.crossroads.addRoute(a.pageName());b=c.interpolate(a.values())}else b=a.values().controller+"."+a.values().action;return b},Object.defineProperty(e.prototype,"routeData",{get:function(){return this._routeData},set:function(a){this._routeData=a},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return this._name||(this._name=e.getPageName(this.routeData)),this._name},enumerable:!0,configurable:!0}),e.prototype.node=function(){return this._pageNode.container},e.prototype.nodes=function(){return this._pageNode},Object.defineProperty(e.prototype,"previous",{get:function(){return this._prevous},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scrollType",{get:function(){return this._scrollType},enumerable:!0,configurable:!0}),e.prototype.hide=function(a){$(this.node()).is(":visible")&&(a=a||p.None,this.hidePageNode(a))},e.prototype.show=function(a){$(this.node()).is(":visible")||(a=a||p.None,this.showPageNode(a))},e.prototype.visible=function(){return"block"==this.node().style.display},e.prototype.hidePageNode=function(a){var b=this;this.on_hiding({}),window.move||(a=p.None,console.warn("Move is not loaded and swipe is auto disabled."));var c=$.Deferred(),d=$(this.nodes().container).width(),e=$(this.nodes().container).height(),f=function(){b.node().style.display="none",c.resolve(),b.on_hidden({})};switch(a){case p.None:default:f();break;case p.Up:move(this.nodes().container).y(e).end().y(0-e).duration(this._hideTime).end(f);break;case p.Donw:move(this.nodes().container).y(e).duration(this._hideTime).end(f);break;case p.Right:move(this.node()).x(d).duration(this._hideTime).end(f);break;case p.Left:move(this.node()).x(0-d).duration(this._hideTime).end(f)}return c},e.prototype.showPageNode=function(a){var b=this;window.move||(a=p.None,console.warn("Move is not loaded and swipe is auto disabled.")),this.on_showing({});var c=$.Deferred();this.node().style.display="block";var d=$(this.nodes().container).width(),e=$(this.nodes().container).height(),f=function(){c.resolve()};switch(a){case p.None:default:f();break;case p.Donw:move(this.node()).y(0-e).duration(0).end(f),move(this.node()).y(0).duration(0).end(f);break;case p.Up:move(this.node()).y(e).duration(0).end(),move(this.node()).y(0).duration(this._showTime).end(f);break;case p.Right:move(this.node()).x(0-d).duration(0).end(),move(this.node()).x(0).duration(this._showTime).end(f);break;case p.Left:move(this.node()).x(d).duration(0).end(),move(this.node()).x(0).duration(this._showTime).end(f)}return c.done(function(){b.on_shown({})}),c},e.prototype.fireEvent=function(a,c){var d=this;return"resolved"==this.actionExecuted.state()?b(a,this,c):this.actionExecuted.pipe(function(){return b(a,d,c)})},e.prototype.disableHeaderFooterTouchMove=function(){$([this.nodes().footer,this.nodes().header]).on("touchmove",function(a){a.preventDefault()})},e.prototype.on_load=function(b){var c=this,d=b instanceof l?b:new l(this,b.loadType,b.loading);null==d.loading&&(d.loading=d.loadType==a.PageLoadType.scroll?this.bottomLoading:this.formLoading),d.loading.show();var e=this.fireEvent(this.load,d);return e.done(function(){return d.loading.hide()}),null==this.view?e.done(function(){return c.on_loadCompleted(d)}):"resolved"==this.view.state()?e.done(function(){return c.on_loadCompleted(d)}):$.when(this.view,e).done(function(){return c.on_loadCompleted(d)}),e},e.prototype.on_loadCompleted=function(a){var b=this;return this.fireEvent(this.loadCompleted,a).done(function(){window.setTimeout(function(){return b.refreshUI()},100)})},e.prototype.on_closing=function(a){return this.fireEvent(this.closing,a)},e.prototype.on_closed=function(a){return this.fireEvent(this.closed,a)},e.prototype.on_scroll=function(a){return this.fireEvent(this.scroll,a)},e.prototype.on_showing=function(a){return this.fireEvent(this.showing,a)},e.prototype.on_shown=function(a){return this.fireEvent(this.shown,a)},e.prototype.on_hiding=function(a){return this.fireEvent(this.hiding,a)},e.prototype.on_hidden=function(a){return this.fireEvent(this.hidden,a)},e.prototype.on_scrollEnd=function(a){return this.fireEvent(this.scrollEnd,a)},e.prototype.open=function(b,c){var d=this;if(this._openResult)return this._openResult;c=c||p.None;var e=this.showPageNode(c),f=this.createPageLoadArguments(b,a.PageLoadType.open,this.formLoading);if(f.loading.show(),null==this.view&&null==this.viewHtml)throw a.Errors.viewCanntNull();return this.action&&this.action.done(function(a){a.execute(d),d.actionExecuted.resolve(),d.view&&d.view.done(function(a){return d.viewHtml=a}),d.on_load(f)}),e},e.prototype.close=function(a,b){var c=this;this.is_closed||(this.on_closing(a),this.visible()?this.hidePageNode(b).done(function(){c.node().parentNode.removeChild(c.node())}):this.node().parentNode.removeChild(this.node()),a=a||{},this.on_closed(a),this.is_closed=!0)},e.page_scrollEnd=function(a,b){var c=b.scrollTop,d=b.scrollHeight,e=b.clientHeight,f=e/3;if(!(d-f>e+c)&&a.enableScrollLoad){var g=$.extend(a.routeData.values(),{loadType:k.scroll,loading:a.bottomLoading});a.on_load(g)}},e.prototype.refreshUI=function(){this.ios_scroller&&this.ios_scroller.refresh()},e.animationTime=300,e}();a.Page=t}(chitu||(chitu={}));var chitu;!function(a){var b=function(){function a(a,b){this._view=a,this._routeData=b}return a.prototype.view=function(){return this._view},a.prototype.routeData=function(){return this._routeData},a}();a.PageContext=b}(chitu||(chitu={}));var chitu;!function(a){var b=function(){function a(a,b,c){this._name=a,this._pattern=b,this._defaults=c}return a.prototype.name=function(){return this._name},a.prototype.defaults=function(){return this._defaults},a.prototype.url=function(){return this._pattern},a}();a.Route=b}(chitu||(chitu={}));var chitu;!function(a){var b=a.Errors,c=function(){function c(){this._init()}return c.prototype._init=function(){var a=window.crossroads;this._source=a.create(),this._source.ignoreCase=!0,this._source.normalizeFn=a.NORM_AS_OBJECT,this._priority=0},c.prototype.count=function(){return this._source.getNumRoutes()},c.prototype.mapRoute=function(c){c=c||{};var d=c.name,e=c.url,f=c.defaults,g=c.rules||{};if(!d)throw b.argumentNull("name");if(!e)throw b.argumentNull("url");this._priority=this._priority+1;var h=new a.Route(d,e,f);h.viewPath=c.viewPath,h.actionPath=c.actionPath;var i=this._source.addRoute(e,function(a){},this._priority);if(i.rules=g,i.newRoute=h,null==this._defaultRoute){if(this._defaultRoute=h,null==this._defaultRoute.viewPath)throw new Error("default route require view path.");if(null==this._defaultRoute.actionPath)throw new Error("default route require action path.")}return h.viewPath=h.viewPath||this._defaultRoute.viewPath,h.actionPath=h.actionPath||this._defaultRoute.actionPath,h},c.prototype.getRouteData=function(c){var d=this._source.getRouteData(c);if(null==d)throw b.canntParseUrl(c);for(var e={},f=d.route._paramsIds||[],g=0;g<f.length;g++){var h=f[g];e[h]=d.params[0][h]}var i=new a.RouteData(c);return i.values(e),i.actionPath(d.route.newRoute.actionPath),i.viewPath(d.route.newRoute.viewPath),i},c.defaultRouteName="default",c}();a.RouteCollection=c}(chitu||(chitu={}));var chitu;!function(a){var b=function(){function a(a){this._url=a}return a.prototype.values=function(a){return void 0===a&&(a=void 0),void 0!==a&&(this._values=a),this._values},a.prototype.viewPath=function(a){return void 0===a&&(a=void 0),void 0!==a&&(this._viewPath=a),this._viewPath},a.prototype.actionPath=function(a){return void 0===a&&(a=void 0),void 0!==a&&(this._actionPath=a),this._actionPath},a.prototype.pageName=function(a){return void 0===a&&(a=void 0),void 0!==a&&(this._pageName=a),this._pageName},a.prototype.url=function(){return this._url},a}();a.RouteData=b}(chitu||(chitu={}));var chitu;!function(a){var b=function(){function a(){}return a}();a.ScrollArguments=b;var c=function(){function a(a){var c,d,e=new b,f=300,g=function(a){null==d&&(d=0,d=window.setInterval(function(){return c==e.scrollTop?(window.clearInterval(d),d=null,c=null,void a.on_scrollEnd(e)):void(c=e.scrollTop)},f))},h=a.nodes().body;h.onscroll=function(){var b={scrollTop:h.scrollTop,scrollHeight:h.scrollHeight,clientHeight:h.clientHeight};a.on_scroll(b),e.clientHeight=b.clientHeight,e.scrollHeight=b.scrollHeight,e.scrollTop=b.scrollTop,g(a)}}return a}();a.DivScroll=c}(chitu||(chitu={}));var chitu;!function(a){function b(a){null==d&&(d=0,d=window.setInterval(function(){return c==e.scrollTop?(window.clearInterval(d),d=null,c=null,void a.on_scrollEnd(e)):void(c=e.scrollTop)},f))}var c,d,e=new a.ScrollArguments,f=300,g=function(){function a(a){$(document).scroll(function(c){if(a.visible()){var d={scrollTop:$(document).scrollTop(),scrollHeight:document.body.scrollHeight,clientHeight:$(window).height()};e.clientHeight=d.clientHeight,e.scrollHeight=d.scrollHeight,e.scrollTop=d.scrollTop,$(a.node()).data(a.name+"_scroll_top",d.scrollTop),
b(a)}}),a.shown.add(function(b){var c=$(a.node()).data(a.name+"_scroll_top");null!=c&&$(document).scrollTop(new Number(c).valueOf())})}return a}();a.DocumentScroll=g}(chitu||(chitu={}));var chitu;!function(a){var b=function(){function a(a){var b=this;requirejs(["iscroll"],function(){return b.init(a)})}return a.prototype.init=function(a){var b={tap:!0,useTransition:!1,HWCompositing:!1,preventDefault:!0,probeType:1},c=this.iscroller=a.iscroller=new IScroll(a.nodes().body,b);c.on("scrollEnd",function(){var b=this,c={scrollTop:0-b.y,scrollHeight:b.scrollerHeight,clientHeight:b.wrapperHeight};console.log("directionY:"+b.directionY),console.log("startY:"+b.startY),console.log("scroller.y:"+b.y),a.on_scrollEnd(c)}),c.on("scroll",function(){var b=this,c={scrollTop:0-b.y,scrollHeight:b.scrollerHeight,clientHeight:b.wrapperHeight};console.log("directionY:"+b.directionY),console.log("startY:"+b.startY),console.log("scroller.y:"+b.y),a.on_scroll(c)}),function(b,c){$(c).on("tap",function(b){if(0!=a.iscroller.enabled)for(var c=4,d=1,e=b.target;null!=e;){if("A"==e.tagName)return window.open($(e).attr("href"),"_self");if(e=e.parentNode,d+=1,d>c)return}})}(c,a.nodes().body),a.closing.add(function(){return c.destroy()}),$(window).on("resize",function(){window.setTimeout(function(){return c.refresh()},500)})},a.prototype.refresh=function(){this.iscroller&&this.iscroller.refresh()},a}();a.IOSScroll=b,a.scroll=function(a,b){$(a.nodes().body).addClass("wrapper"),$(a.nodes().content).addClass("scroller");a._wrapperNode=a.nodes().body;a._scrollerNode=a.nodes().content}}(chitu||(chitu={}));var chitu;!function(a){var b=a.Errors,c=function(){function a(){}return a.isType=function(a,b){for(var c in a.prototype)if(void 0===b[c])return!1;return!0},a.isDeferred=function(a){return null==a?!1:null!=a.pipe&&null!=a.always&&null!=a.done?!0:!1},a.format=function(a,b,c,d,e,f,g,h,i,j,k){for(var l=[b,c,d,e,f,g,h,i,j,k],m=0;m<l.length&&null!=l[m];m++)a=a.replace(new RegExp("\\{"+m+"\\}","g"),function(){return l[m]});return a},a.fileName=function(a,c){if(!a)throw b.argumentNull("url");c=c||!0,a=a.replace("http://","/");var d=a.replace(/^.*[\\\/]/,"");if(c===!0){var e=d.split(".");d=e[0]}return d},a.log=function(a,b){if(void 0===b&&(b=[]),window.console){if(null==b)return void console.log(a);var c=this.format.apply(this,arguments);console.log(c)}},a.loadjs=function(a){var b=$.Deferred();return requirejs(a,function(){for(var a=[],c=0;c<arguments.length;c++)a[c]=arguments[c];b.resolve.apply(b,a)}),b},a}();a.Utility=c}(chitu||(chitu={}));